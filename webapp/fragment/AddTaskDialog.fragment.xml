<core:FragmentDefinition
    xmlns="sap.uxap"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:m="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form"
>
    <ObjectPageLayout
        id="ObjectPageLayout"
        showTitleInHeaderContent="true"
        alwaysShowContentHeader="false"
        preserveHeaderStateOnScroll="false"
        headerContentPinnable="true"
        isChildPage="true"
        upperCaseAnchorBar="false"
    >
        <headerTitle>
            <ObjectPageDynamicHeaderTitle>
                <expandedHeading>
                    <m:Title
                        text="{= ${AppState>/oSelectedTask/ID} ? ${AppState>/oSelectedTask/ID} : ${AppState>/oSelectedMilestone/ID} }"
                        wrapping="true"
                        visible="false"
                    />
                </expandedHeading>
                <actions>
                    <m:Button
                        id="idEditBtn"
                        text="Manage Activities"
                        type="Critical"
                        icon="sap-icon://activity-2"
                        press="onManageActivity"
                    />
                    <m:Button
                        id="idEditSaveTaskBtn"
                        text="Save"
                        icon="sap-icon://save"
                        type="Critical"
                        press="onSaveTask"
                    />
                    <!-- <m:Button
                        text="Save"
                        icon="sap-icon://save"
                        type="Critical"
                        press="onSaveTask"
                    /> -->

                    <m:Button
                        id="idEditSaveMilestoneBtn"
                        text="Save"
                        icon="sap-icon://save"
                        type="Critical"
                        press="onSaveMilestone"
                    />
                    <m:Button
                        id="idEditSaveAreaBtn"
                        text="Save"
                        icon="sap-icon://save"
                        type="Critical"
                        press="onSaveArea"
                    />
                    <m:Button
                        id="idEditCloseBtn"
                        icon="sap-icon://decline"
                        type="Critical"
                        press="onCloseDetailPage"
                    />
                    <m:Button
                        id="idEditDeleteBtn"
                        icon="sap-icon://delete"
                        type="Critical"
                        visible="false"
                        press="onDeleteMilestone"
                    />
                    <m:Button
                        id="idEditDeleteTaskBtn"
                        icon="sap-icon://delete"
                        type="Critical"
                        visible="false"
                        press="onDeleteTask"
                    />
                </actions>
            </ObjectPageDynamicHeaderTitle>
        </headerTitle>
        <headerContent>
            <m:FlexBox
                wrap="Wrap"
                fitContainer="true"
                alignItems="Stretch"
            />
        </headerContent>
        <sections>
            <ObjectPageSection
                title="{= ${AppState>/makeTaskMilestoneVisiblity/taskvisiblity} ? 'Task Details' : ${AppState>/makeTaskMilestoneVisiblity/milestonevisiblity} ? 'Milestone Details' : 'Edit Area Details'}"
            >
                <subSections>
                    <ObjectPageSubSection>
                        <blocks>
                            <form:SimpleForm
                                id="SimpleFormChange354"
                                editable="true"
                                layout="ResponsiveGridLayout"
                                title=""
                                labelSpanXL="3"
                                labelSpanL="3"
                                labelSpanM="3"
                                labelSpanS="12"
                                adjustLabelSpan="false"
                                emptySpanXL="4"
                                emptySpanL="4"
                                emptySpanM="4"
                                emptySpanS="0"
                                columnsXL="1"
                                columnsL="1"
                                columnsM="1"
                                singleContainerFullSize="false"
                            >
                                <form:content>
                                    <m:Label
                                        text="Task Name"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        required="true"
                                    />
                                    <m:Input
                                        id="name"
                                        value="{AppState>/oSelectedTask/name}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Label
                                        text="Description"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <!-- <m:Input value="Framsys Roadmap" editable="false"/> -->
                                    <m:TextArea
                                        id="description"
                                        value="{AppState>/oSelectedTask/description}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Label
                                        text="Planned Start Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        required="true"
                                    />
                                    <m:DatePicker
                                        id="tstart"
                                        value="{path:'AppState>/oSelectedTask/planned_start', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MMM dd, yyyy' }}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Label
                                        text="Planned Finish Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        required="true"
                                    />
                                    <m:DatePicker
                                        id="tend"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        change="onChangeDate"
                                        value="{path:'AppState>/oSelectedTask/planned_finish', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MMM dd, yyyy' }}"
                                    />
                                    <m:Label
                                        text="Preceding Task"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:ComboBox
                                        id="idPrecedingTask"
                                        showSecondaryValues="true"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        selectedKey="{AppState>/oSelectedTask/precedingTaskID}"
                                        items="{
    path: 'AppState>/aTask'
}"
                                    >
                                        <core:ListItem
                                            key="{AppState>ID}"
                                            text="{AppState>name}"
                                        />
                                    </m:ComboBox>
                                    <m:Label
                                        text="Outcome Description"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:TextArea
                                        id="outcomeDesc"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Label
                                        text="Phase"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        required="true"
                                    />
                                    <m:ComboBox
                                        id="idphase"
                                        showSecondaryValues="true"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        selectedKey="{AppState>/oSelectedTask/phase_ID}"
                                        items="{
                                            path: 'AppState>/aPhase'
                                        }"
                                    >
                                        <core:ListItem
                                            key="{AppState>ID}"
                                            text="{AppState>name}"
                                        />
                                    </m:ComboBox>
                                    <m:Label
                                        text="Area"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        required="true"
                                    />
                                    <m:ComboBox
                                        id="idarea"
                                        showSecondaryValues="true"
                                        selectedKey="{AppState>/oSelectedTask/area_ID}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        items="{
                                            path: 'AppState>/aArea'
                                        }"
                                    >
                                        <core:ListItem
                                            key="{AppState>ID}"
                                            text="{AppState>name}"
                                        />
                                    </m:ComboBox>
                                    <m:Label
                                        text="Value"
                                        required="true"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Input
                                        id="weight"
                                        value="{AppState>/oSelectedTask/pct_weight}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Label
                                        text="Earned Value"
                                        required="false"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Input
                                        id="earnedvalue"
                                        value="{path: 'AppState>/oSelectedTask/earned_value', formatter: '.formatPercentage'}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        editable="false"
                                    />
                                    <m:Label
                                        text="Forecasted Start Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:DatePicker
                                        id="idforecastedstart"
                                        editable="false"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        value="{path:'AppState>/oSelectedTask/fore_act_start', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MMM dd, yyyy' }}"
                                    />
                                    <m:Label
                                        text="Forecasted Finish Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:DatePicker
                                        id="idforecastedfinish"
                                        editable="false"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        value="{path:'AppState>/oSelectedTask/fore_act_finish', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MMM dd, yyyy' }}"
                                    />
                                    <m:Label
                                        text="Actual Start Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:DatePicker
                                        editable="true"
                                        id="idactualstart"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        value=""
                                    />
                                    <m:Label
                                        text="Actual Finish Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:DatePicker
                                        editable="true"
                                        id="idactualfinish"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        value=""
                                    />
                                    <m:Label
                                        text="Percentage of Completion"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Input
                                        value="{path: 'AppState>/oSelectedTask/pct_complete', formatter: '.formatPercentage'}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        editable="false"
                                    />

                                    <m:Label
                                        text="Responsible"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        required="true"
                                    />
                                    <m:ComboBox
                                        id="idowner"
                                        showSecondaryValues="true"
                                        selectedKey="{AppState>/oSelectedTask/responsible_ID}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        items="{
                                            path: '/Employee'
                                        }"
                                    >
                                        <core:ListItem
                                            key="{ID}"
                                            text="{name}"
                                        />
                                    </m:ComboBox>
                                    <m:Label
                                        text="Is Critical to Milestone"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:CheckBox
                                        id="idCriticalToMilestone"
                                        selected="{AppState>/oSelectedTask/isCriticalToMilestone}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Label
                                        text="Contribute to Milestone"
                                        visible="{= ${AppState>/oSelectedTask/isCriticalToMilestone} ? true : false}"
                                        required="true"
                                    />
                                    <m:ComboBox
                                        id="idMilestone"
                                        showSecondaryValues="true"
                                        selectedKey="{AppState>/oSelectedTask/contributeToMilestone_ID}"
                                        visible="{= ${AppState>/oSelectedTask/isCriticalToMilestone} ? true : false}"
                                        items="{
                                            path: '/Milestone'
                                        }"
                                    >
                                        <core:ListItem
                                            key="{ID}"
                                            text="{name}"
                                        />
                                    </m:ComboBox>
                                    <m:Label
                                        text="State"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Input
                                        value="{AppState>/oSelectedTask/state}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        editable="false"
                                    />
                                    <m:Label
                                        text="Status"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                    />
                                    <m:Input
                                        value="{AppState>/oSelectedTask/status}"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/taskvisiblity}"
                                        editable="false"
                                    />

                                    <!-- Milestone Details -->

                                    <m:Label
                                        text="Milestone Name"
                                        required="true"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                    />
                                    <m:Input
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        value="{AppState>/oSelectedMilestone/name}"
                                        id="idmilestonename"
                                    />
                                    <m:Label
                                        text="Description"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                    />
                                    <m:Input
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        value="{AppState>/oSelectedMilestone/description}"
                                        id="idmilestonedesc"
                                    />
                                    <m:Label
                                        text="Phase"
                                        required="true"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                    />
                                    <m:ComboBox
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        id="idmilestonephase"
                                        showSecondaryValues="true"
                                        selectedKey="{AppState>/oSelectedMilestone/parent_key_ID}"
                                        items="{
                                            path: 'AppState>/aPhase'
                                        }"
                                    >
                                        <core:ListItem
                                            key="{AppState>ID}"
                                            text="{AppState>name}"
                                        />
                                    </m:ComboBox>
                                    <m:Label
                                        text="Target Achievement Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        required="true"
                                    />
                                    <m:DatePicker
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        value="{path:'AppState>/oSelectedMilestone/targetAchievementDate', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MMM dd, yyyy' }}"
                                        id="idmilestonetargetDate"
                                    />
                                    <m:Label
                                        text="Forecasted Achievement Date"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                    />
                                    <m:DatePicker
                                        id="idmilestoneforecastedDate"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        value="{path:'AppState>/oSelectedMilestone/fore_act_achievement_date', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MMM dd, yyyy' }}"
                                        editable="true"
                                    />
                                    <m:Label
                                        text="Percentage of Completion"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                    />
                                    <m:Input
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        editable="false"
                                        value="{AppState>/oSelectedMilestone/pct_complete}"
                                    />
                                    <m:Label
                                        text="Status"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                    />
                                    <m:Input
                                        visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                        editable="false"
                                        value="{AppState>/oSelectedMilestone/status}"
                                    />

                                    <!-- Edit Area Details -->

                                    <m:Label
                                        text="Area Name"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/EditAreaVisiblity}"
                                    />
                                    <m:Input
                                        visible="{AppState>/makeTaskMilestoneVisiblity/EditAreaVisiblity}"
                                        editable="false"
                                        value="{AppState>/oSelectedArea/name}"
                                    />
                                    <m:Label
                                        text="Responsible"
                                        required="true"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/EditAreaVisiblity}"
                                    />
                                    <m:ComboBox
                                        visible="{AppState>/makeTaskMilestoneVisiblity/EditAreaVisiblity}"
                                        id="idAreaOwner"
                                        showSecondaryValues="true"
                                        selectedKey="{AppState>/oSelectedArea/responsible_ID}"
                                        items="{
                                            path: '/Employee'
                                        }"
                                    >
                                        <core:ListItem
                                            key="{ID}"
                                            text="{name}"
                                        />
                                    </m:ComboBox>
                                    <m:Label
                                        text="Description"
                                        visible="{AppState>/makeTaskMilestoneVisiblity/EditAreaVisiblity}"
                                    />
                                    <m:TextArea
                                        visible="{AppState>/makeTaskMilestoneVisiblity/EditAreaVisiblity}"
                                        editable="false"
                                        rows="10"
                                        value="{AppState>/oSelectedArea/Description}"
                                    />
                                </form:content>
                            </form:SimpleForm>
                        </blocks>
                    </ObjectPageSubSection>

                        <ObjectPageSubSection visible="{= ${AppState>/oSelectedMilestone/ID} ? true : false}" >
                        <blocks>

                              <m:Table
                               visible="{AppState>/makeTaskMilestoneVisiblity/milestonevisiblity}"
                                id="MileStoneTaskTable"
                                inset="false"
                                width="100%"
                                items="{AppState>/aTask}"
                            >
                                <m:columns>
                                    <m:Column>
                                        <m:Label text="Task Linked To This MileStone" />
                                    </m:Column>
                                </m:columns>
                                <!-- Bind the items -->
                                <m:items>
                                    <m:ColumnListItem>
                                        <m:cells>
                                            <m:Text text="{AppState>name}" />
                                        </m:cells>
                                    </m:ColumnListItem>
                                </m:items>
                            </m:Table>
                        </blocks>
                        </ObjectPageSubSection>
                </subSections>
            </ObjectPageSection>
        </sections>
    </ObjectPageLayout>
</core:FragmentDefinition>
